<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PWA Meta Tags -->
    <title>Terra MIDI - Plataforma Oficial NET-MIDI-T.A.</title>
    <meta name="description" content="Plataforma oficial Terra Eletr√¥nica com NET-MIDI-T.A. para musicoterapia e controle de instrumentos Board Bells, Big KBD, Giro Som e Musical Beam">
    <!-- Theme color - PWA standard, supported by Chrome, Edge, Safari -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Terra MIDI">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="16x16" href="Logos/icon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="Logos/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="Logos/icon-48x48.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="Logos/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="Logos/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="Logos/icon-192x192.png">
    
    <!-- Splash Screens iOS -->
    <link rel="apple-touch-startup-image" href="Logos/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="Logos/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="Logos/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-1668x2224.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="Logos/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/instrument-grid.css">
    <link rel="stylesheet" href="css/instrument-selector.css">
    <link rel="stylesheet" href="css/catalog-list.css">
    <link rel="stylesheet" href="css/catalog-navigation.css">
    <link rel="stylesheet" href="css/virtual-keyboard.css">
    <link rel="stylesheet" href="css/midi-ui.css">
    <link rel="stylesheet" href="css/pwa-installer.css">
    <link rel="stylesheet" href="css/advanced-installer.css">
    <link rel="stylesheet" href="css/legal-modals.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/instruments-professional.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <div class="logo">
                    <img src="Logos/icon-512x512.png" alt="Terra Midi - Plataforma NET-MIDI-T.A." class="logo-image-main">
                    <div class="logo-text">
                        <h1>Terra Midi</h1>
                        <p class="logo-subtitle">Plataforma NET-MIDI-T.A.</p>
                        <p class="logo-tagline">Exclusivo para clientes Terra Eletr√¥nica</p>
                    </div>
                </div>
                
                <!-- üîß System Status Monitor - Integrado ao header -->
                <div id="system-status-indicator" class="system-status-indicator" title="Clique para ver status do sistema">
                    <div class="status-dot" id="status-dot"></div>
                    <span class="status-label">Sistema</span>
                </div>
            </div>

            <div class="hero-grid">
                <div class="hero-copy">
                    <h2 class="hero-title">Central Terap√™utica Oficial dos Instrumentos NET-MIDI-T.A.</h2>
                    <p class="hero-description">Comece agora com o Board Bells totalmente integrado ao painel web responsivo. <strong>Exclusivo para clientes Terra Eletr√¥nica:</strong> acesso gratuito e acompanhamento do desenvolvimento dos m√≥dulos para Board Sound 12, Big KBD, Giro Sound e Musical Beam.</p>
                    <div class="hero-cta">
                        <a class="hero-primary" href="#player">üéπ Ativar Terra Midi Agora</a>
                        <span class="hero-link-subtext">‚ú® Incluso sem custo na compra dos instrumentos Terra Eletr√¥nica</span>
                    </div>
                </div>

                <div class="hero-showcase">
                    <div class="hero-metrics">
                        <div class="hero-metric">
                            <span class="metric-icon" aria-hidden="true">üì°</span>
                            <span class="metric-heading">Lat√™ncia &lt; 10&nbsp;ms</span>
                            <p class="metric-description">Rede wireless NET-MIDI-T.A. garante resposta imediata para conduzir exerc√≠cios terap√™uticos sem atrasos.</p>
                        </div>
                        <div class="hero-metric">
                            <span class="metric-icon" aria-hidden="true">üéÅ</span>
                            <span class="metric-heading">Acesso exclusivo</span>
                            <p class="metric-description">Clientes Terra Eletr√¥nica usam o Terra Midi sem mensalidades, com suporte oficial dedicado.</p>
                        </div>
                        <div class="hero-metric">
                            <span class="metric-icon" aria-hidden="true">üß©</span>
                            <span class="metric-heading">Board Bells pronto</span>
                            <p class="metric-description">Painel assistido por IA com cache offline. Acompanhe o roadmap dos demais instrumentos em tempo real.</p>
                        </div>
                        <div class="hero-metric hero-metric-action">
                            <span class="metric-icon" aria-hidden="true">üë•</span>
                            <span class="metric-heading">Gest√£o de Pacientes</span>
                            <p class="metric-description">Controle cadastros, sess√µes e dashboards diretamente no m√≥dulo lateral dedicado.</p>
                            <button id="btn-patient-module" class="btn-log-action hero-metric-button" aria-controls="patient-module" aria-expanded="false">üë• Pacientes</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- üéµ Audio Unlock Overlay - Aparece quando AudioContext precisa ser ativado -->
        <div id="audio-unlock-overlay" class="audio-unlock-overlay">
            <div class="audio-unlock-card">
                <div class="audio-unlock-icon">üéµ</div>
                <h3>Ativar √Åudio</h3>
                <p>Clique no bot√£o para ativar o sistema de √°udio</p>
                <button id="audio-unlock-button" class="audio-unlock-button">üîä Ativar √Åudio</button>
            </div>
        </div>

        <!--  System Log Panel - Oculto por padr√£o -->
        <div id="system-log-panel" class="system-log-panel">
            <div class="log-panel-header">
                <h3>üìã Log do Sistema</h3>
                <button id="close-log-panel" class="btn-close-panel" aria-label="Fechar painel">‚úï</button>
            </div>
            
            <div class="log-panel-toolbar">
                <button id="btn-clear-logs" class="btn-log-action">üóëÔ∏è Limpar</button>
                <button id="btn-export-logs" class="btn-log-action">üíæ Exportar</button>
                <button id="btn-refresh-stats" class="btn-log-action">üîÑ Atualizar</button>
                <button id="btn-toggle-effects" class="btn-log-action" aria-controls="effects-panel" aria-expanded="false">üéõÔ∏è Efeitos</button>
                <button id="btn-install-pwa" class="btn-log-action btn-install-pwa">üì≤ Instalar App</button>
                <div class="log-filter">
                    <label>
                        <input type="checkbox" id="filter-info" checked> Info
                    </label>
                    <label>
                        <input type="checkbox" id="filter-warn" checked> Avisos
                    </label>
                    <label>
                        <input type="checkbox" id="filter-error" checked> Erros
                    </label>
                </div>
            </div>

            <div class="log-panel-stats">
                <div class="stat-card">
                    <span class="stat-label">Cache</span>
                    <span class="stat-value" id="stat-cache-size">--</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Soundfonts</span>
                    <span class="stat-value" id="stat-soundfont-count">--</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Quota</span>
                    <span class="stat-value" id="stat-quota-percent">--</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Status</span>
                    <span class="stat-value" id="stat-system-status">OK</span>
                </div>
            </div>

            <div class="log-panel-content" id="log-panel-content">
                <div class="log-empty">
                    <span>üìã</span>
                    <p>Nenhum log registrado ainda</p>
                </div>
            </div>
        </div>

        <aside id="patient-module" class="patient-module" role="dialog" aria-modal="true" aria-labelledby="patient-module-title" aria-hidden="true" hidden>
            <div class="patient-module-header">
                <h3 id="patient-module-title">üë• Gest√£o de Pacientes</h3>
                <button type="button" id="patient-module-close" class="patient-module-close" aria-label="Fechar painel de pacientes">‚úï</button>
            </div>

            <div class="patient-module-toolbar">
                <div class="patient-module-actions">
                    <button type="button" id="patient-export" class="patient-secondary-action">‚¨áÔ∏è Exportar dados</button>
                    <button type="button" id="patient-import" class="patient-secondary-action">‚¨ÜÔ∏è Importar dados</button>
                    <button type="button" id="patient-reset" class="patient-secondary-action" data-action="reset">üßπ Limpar m√≥dulo</button>
                </div>
                <p class="patient-module-hint">Dados ficam salvos localmente no dispositivo. Fa√ßa backup para transferir entre esta√ß√µes.</p>
            </div>

            <nav class="patient-module-tabs" role="tablist" aria-label="Gestor de pacientes">
                <button type="button" class="patient-tab is-active" data-tab-target="patient-tab-cadastro" role="tab" aria-selected="true" aria-controls="patient-tab-cadastro">üìá Cadastro</button>
                <button type="button" class="patient-tab" data-tab-target="patient-tab-sessoes" role="tab" aria-selected="false" aria-controls="patient-tab-sessoes">üìù Sess√µes</button>
                <button type="button" class="patient-tab" data-tab-target="patient-tab-dashboard" role="tab" aria-selected="false" aria-controls="patient-tab-dashboard">üìä Dashboard</button>
            </nav>

            <div class="patient-tabpanels">
                <section id="patient-tab-cadastro" class="patient-panel is-active" role="tabpanel" tabindex="0">
                    <form id="patient-form" class="patient-form" novalidate>
                        <div class="form-row">
                            <label for="patient-selector">Pacientes salvos</label>
                            <select id="patient-selector" name="patient-selector" aria-describedby="patient-selector-hint">
                                <option value="">Novo cadastro</option>
                            </select>
                            <span id="patient-selector-hint" class="field-hint">Selecione para editar dados existentes.</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-row">
                                <label for="patient-full-name">Nome completo <span aria-hidden="true">*</span></label>
                                <input type="text" id="patient-full-name" name="fullName" required autocomplete="name" placeholder="Ex.: Ana Clara Ribeiro" />
                            </div>
                            <div class="form-row">
                                <label for="patient-birth-date">Data de nascimento</label>
                                <input type="date" id="patient-birth-date" name="birthDate" />
                            </div>
                            <div class="form-row">
                                <label for="patient-diagnosis">Diagn√≥stico ou condi√ß√£o</label>
                                <textarea id="patient-diagnosis" name="diagnosis" rows="2" placeholder="Informa√ß√µes cl√≠nicas relevantes"></textarea>
                            </div>
                            <div class="form-row">
                                <label for="patient-contact">Contato do paciente ou respons√°vel</label>
                                <input type="text" id="patient-contact" name="contact" autocomplete="tel" placeholder="Telefone, e-mail ou outro canal" />
                            </div>
                            <div class="form-row">
                                <label for="patient-history">Hist√≥rico musical e prefer√™ncias</label>
                                <textarea id="patient-history" name="musicalHistory" rows="3" placeholder="Instrumentos j√° usados, estilos favoritos, repert√≥rio terap√™utico"></textarea>
                            </div>
                            <div class="form-row">
                                <label for="patient-goals">Objetivos terap√™uticos</label>
                                <textarea id="patient-goals" name="therapeuticGoals" rows="3" placeholder="Metas para musicoterapia (cognitivas, motoras, emocionais)"></textarea>
                            </div>
                            <div class="form-row">
                                <label for="patient-notes">Observa√ß√µes gerais</label>
                                <textarea id="patient-notes" name="notes" rows="3" placeholder="Observa√ß√µes adicionais sobre o paciente"></textarea>
                            </div>
                        </div>

                        <div class="patient-form-actions">
                            <button type="submit" class="patient-primary-action">üíæ Salvar cadastro</button>
                            <button type="button" id="patient-form-new" class="patient-secondary-action">‚ûï Novo paciente</button>
                            <button type="button" id="patient-delete" class="patient-danger-action" data-action="delete" disabled>üóëÔ∏è Remover</button>
                        </div>
                    </form>

                    <div class="patient-list-wrapper">
                        <h4>Pacientes registrados</h4>
                        <ul id="patient-list" class="patient-list" aria-live="polite"></ul>
                    </div>
                </section>

                <section id="patient-tab-sessoes" class="patient-panel" role="tabpanel" tabindex="0" hidden>
                    <form id="session-form" class="session-form" novalidate>
                        <div class="form-row">
                            <label for="session-patient-selector">Paciente</label>
                            <select id="session-patient-selector" required>
                                <option value="">Selecione um paciente</option>
                            </select>
                        </div>

                        <div class="form-grid">
                            <div class="form-row">
                                <label for="session-date">Data e hora <span aria-hidden="true">*</span></label>
                                <input type="datetime-local" id="session-date" required />
                            </div>
                            <div class="form-row">
                                <label for="session-instruments">Instrumentos utilizados</label>
                                <select id="session-instruments" multiple size="4" aria-describedby="session-instruments-hint">
                                    <option value="board-bells">Board Bells</option>
                                    <option value="big-kbd">Big KBD</option>
                                    <option value="giro-som">Giro Som</option>
                                    <option value="musical-beam">Musical Beam</option>
                                    <option value="piano">Piano</option>
                                    <option value="cordas">Cordas</option>
                                    <option value="percussao">Percuss√£o</option>
                                    <option value="outros">Outros</option>
                                </select>
                                <span id="session-instruments-hint" class="field-hint">Use Ctrl/Cmd para selecionar m√∫ltiplos itens.</span>
                            </div>
                            <div class="form-row">
                                <label for="session-duration">Tempo de execu√ß√£o (minutos)</label>
                                <input type="number" id="session-duration" min="0" step="5" placeholder="Ex.: 45" />
                            </div>
                            <div class="form-row">
                                <label for="session-engagement">Engajamento e resposta <span class="value-display" id="session-engagement-value">50%</span></label>
                                <input type="range" id="session-engagement" min="0" max="100" step="10" value="50" />
                                <textarea id="session-engagement-notes" rows="2" placeholder="Notas sobre participa√ß√£o, express√£o emocional, aten√ß√£o."></textarea>
                            </div>
                            <div class="form-row">
                                <label for="session-qualitative">Avalia√ß√£o qualitativa</label>
                                <textarea id="session-qualitative" rows="3" placeholder="Descri√ß√£o narrativa do progresso"></textarea>
                            </div>
                            <div class="form-row">
                                <label for="session-quantitative">Avalia√ß√£o quantitativa (0-10)</label>
                                <input type="number" id="session-quantitative" min="0" max="10" step="0.5" placeholder="Ex.: 7.5" />
                            </div>
                            <div class="form-row">
                                <label for="session-comments">Coment√°rios e plano para pr√≥xima sess√£o</label>
                                <textarea id="session-comments" rows="3" placeholder="Recomenda√ß√µes, repert√≥rio sugerido, ajustes terap√™uticos"></textarea>
                            </div>
                        </div>

                        <div class="session-form-actions">
                            <button type="submit" class="patient-primary-action">üíæ Registrar sess√£o</button>
                            <button type="button" id="session-reset" class="patient-secondary-action">‚ûï Nova sess√£o</button>
                            <button type="button" id="session-delete" class="patient-danger-action" data-action="delete-session" disabled>üóëÔ∏è Remover sess√£o</button>
                        </div>
                    </form>

                    <div class="session-timeline" aria-live="polite">
                        <h4>Linha do tempo terap√™utica</h4>
                        <div class="session-timeline-empty" hidden>
                            <p>Selecione um paciente para visualizar o hist√≥rico das sess√µes.</p>
                        </div>
                        <ul id="session-list" class="session-list"></ul>
                    </div>
                </section>

                <section id="patient-tab-dashboard" class="patient-panel" role="tabpanel" tabindex="0" hidden>
                    <div class="dashboard-overview">
                        <div class="dashboard-card">
                            <span class="dashboard-label">Pacientes ativos</span>
                            <span class="dashboard-value" id="dashboard-total-patients">0</span>
                        </div>
                        <div class="dashboard-card">
                            <span class="dashboard-label">Sess√µes registradas</span>
                            <span class="dashboard-value" id="dashboard-total-sessions">0</span>
                        </div>
                        <div class="dashboard-card">
                            <span class="dashboard-label">Engajamento m√©dio</span>
                            <span class="dashboard-value" id="dashboard-average-engagement">--</span>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h4>Instrumentos mais utilizados</h4>
                        <ul id="dashboard-instrument-chart" class="instrument-chart" aria-live="polite"></ul>
                    </div>

                    <div class="dashboard-section">
                        <h4>√öltimas notas qualitativas</h4>
                        <ul id="dashboard-qualitative" class="qualitative-notes" aria-live="polite"></ul>
                    </div>
                </section>
            </div>

            <footer class="patient-module-footer">
                <small>TerraMidi mant√©m os cadastros localmente para garantir confidencialidade. Utilize a exporta√ß√£o para compartilhar com a equipe.</small>
            </footer>

            <input type="file" id="patient-import-input" accept="application/json" hidden>
        </aside>

        <div id="patient-module-backdrop" class="patient-module-backdrop" hidden></div>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Player Tab -->
            <section id="player" class="player-section">
                <div class="player-container">
                    <h2>üéπ Player Terap√™utico</h2>
                    
                    <!-- Catalog Navigation Display -->
                    <div class="catalog-navigation-display" id="catalog-nav-display">
                        <div class="catalog-nav-header">
                            <h3 class="catalog-nav-title">
                                üéº Navega√ß√£o por Cat√°logo
                            </h3>
                            <span id="catalog-index-display" class="catalog-index-badge">1 / 811</span>
                        </div>
                        
                        <div class="catalog-info">
                            <div id="catalog-soundfont-name" class="catalog-soundfont-name">Piano Ac√∫stico de Cauda</div>
                            <div id="catalog-category-name" class="catalog-category-path">Pianos ‚Üí Piano Ac√∫stico de Cauda</div>
                        </div>
                        
                        <div class="catalog-progress-container">
                            <div id="catalog-progress-bar" class="catalog-progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="811" aria-label="Progresso no cat√°logo de soundfonts"></div>
                        </div>
                        
                        <div class="catalog-hint">
                            <span>üí°</span>
                            <span>Use Program Change no seu dispositivo MIDI para navegar</span>
                        </div>
                    </div>
                    
                    <!-- Virtual Keyboard -->
                    <div class="virtual-keyboard">
                        <!-- üîì Bot√£o de Libera√ß√£o de Notas -->
                        <div class="keyboard-controls">
                            <button 
                                id="toggle-quick-instrument-lock" 
                                class="btn-lock-toggle unlocked" 
                                title="Notas liberadas - Sele√ß√£o r√°pida de instrumentos dispon√≠vel"
                                aria-label="Alternar bloqueio de notas para sele√ß√£o r√°pida">
                            </button>
                        </div>
                        
                        <div class="keyboard-container">
                            <div class="key" data-note="C" data-color="#FF6B6B">
                                <span class="note-name">D√ì</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="D" data-color="#4ECDC4">
                                <span class="note-name">R√â</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="E" data-color="#45B7D1">
                                <span class="note-name">MI</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="F" data-color="#96CEB4">
                                <span class="note-name">F√Å</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="G" data-color="#FFEAA7">
                                <span class="note-name">SOL</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="A" data-color="#DDA0DD">
                                <span class="note-name">L√Å</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="B" data-color="#98D8C8">
                                <span class="note-name">SI</span>
                                <span class="soundfont-label"></span>
                            </div>
                            <div class="key" data-note="C2" data-color="#FF6B6B">
                                <span class="note-name">D√ì</span>
                                <span class="soundfont-label"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instrument Selection - Compact Edition -->
                    <section class="instrument-selection" aria-labelledby="instruments-heading">
                        <header class="section-header">
                            <div class="header-content">
                                <h3 id="instruments-heading" class="section-title">
                                    <span class="title-icon" aria-hidden="true">üéº</span>
                                    <span class="title-text">Instrumentos Terap√™uticos</span>
                                </h3>
                            </div>
                            <div class="header-actions">
                                <button type="button" class="action-btn btn-refresh" id="refresh-instruments" aria-label="Recarregar">
                                    <span class="btn-icon">üîÑ</span>
                                </button>
                                <button type="button" class="action-btn btn-favorites" id="show-favorites" aria-label="Favoritos">
                                    <span class="btn-icon">‚≠ê</span>
                                    <span class="badge" id="favorites-count">0</span>
                                </button>
                            </div>
                        </header>

                        <!-- Instruments Grid -->
                        <div class="instruments-panel">
                            <div class="instrument-selector-wrapper">
                                <span class="instrument-selector-label">Selecionar instrumento r√°pido</span>
                                <div class="instrument-grid" id="instrument-grid" aria-label="Lista de instrumentos">
                                    <!-- UI do seletor e cat√°logo ser√£o injetados via JavaScript -->
                                    <div class="grid-loading" role="status" aria-live="polite">
                                        <span class="loading-spinner" aria-hidden="true">üéµ</span>
                                        <p class="loading-text">Carregando instrumentos...</p>
                                    </div>
                                </div>
                            </div>

                            <div class="results-info" role="status" aria-live="polite">
                                <button type="button" class="btn-link btn-clear-filters" id="clear-filters">
                                    Limpar filtros
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Audio Effects Controls -->
                    <div class="effects-panel" id="effects-panel" role="dialog" aria-modal="true" aria-labelledby="effects-panel-title" tabindex="-1" aria-hidden="true" hidden>
                        <button type="button" id="effects-panel-close" class="effects-panel-close" aria-label="Fechar painel de efeitos">‚úï</button>
                        <h3 id="effects-panel-title">üéõÔ∏è Controles de √Åudio</h3>
                        <div class="effects-grid">
                            <!-- Master Volume -->
                            <div class="effect-control">
                                <label for="master-volume">üîä Volume Master</label>
                                <input type="range" id="master-volume" min="0" max="100" value="80" step="1">
                                <span class="value-display">80%</span>
                            </div>
                            
                            <!-- Reverb -->
                            <div class="effect-control">
                                <label for="reverb-amount">üåä Reverb (Eco)</label>
                                <input type="range" id="reverb-amount" min="0" max="100" value="30" step="1">
                                <span class="value-display">30%</span>
                            </div>
                            
                            <!-- Envelope Preset -->
                            <div class="effect-control">
                                <label for="envelope-preset">üìä Envelope ADSR</label>
                                <select id="envelope-preset">
                                    <option value="therapeutic-calm" selected>Terap√™utico - Calmo</option>
                                    <option value="therapeutic-alert">Terap√™utico - Alerta</option>
                                    <option value="therapeutic-sleep">Terap√™utico - Sono</option>
                                    <option value="piano-natural">Piano Natural</option>
                                    <option value="string-pad">Strings Sustentadas</option>
                                    <option value="organ-sustained">√ìrg√£o Sustentado</option>
                                </select>
                            </div>
                            
                            <!-- Equalizer Toggle -->
                            <div class="effect-control">
                                <label for="eq-preset">üéöÔ∏è Equalizer</label>
                                <select id="eq-preset">
                                    <option value="flat" selected>Flat (Sem EQ)</option>
                                    <option value="bass-boost">Bass Boost</option>
                                    <option value="treble-boost">Treble Boost</option>
                                    <option value="warm">Warm (Quente)</option>
                                    <option value="bright">Bright (Brilhante)</option>
                                    <option value="vocal">Vocal</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Advanced Effects -->
                        <details class="advanced-effects">
                            <summary>üîß Efeitos Avan√ßados</summary>
                            <div class="advanced-grid">
                                <!-- Compressor -->
                                <div class="effect-control">
                                    <label for="compressor-threshold">Compressor Threshold</label>
                                    <input type="range" id="compressor-threshold" min="-100" max="0" value="-50" step="1">
                                    <span class="value-display">-50 dB</span>
                                </div>
                                
                                <div class="effect-control">
                                    <label for="compressor-ratio">Compressor Ratio</label>
                                    <input type="range" id="compressor-ratio" min="1" max="20" value="12" step="1">
                                    <span class="value-display">12:1</span>
                                </div>
                                
                                <!-- Flanger -->
                                <div class="effect-control">
                                    <label for="flanger-toggle">
                                        <input type="checkbox" id="flanger-toggle"> Flanger
                                    </label>
                                </div>
                                
                                <div class="effect-control">
                                    <label for="flanger-speed">Flanger Speed</label>
                                    <input type="range" id="flanger-speed" min="0.1" max="5" value="0.5" step="0.1">
                                    <span class="value-display">0.5 Hz</span>
                                </div>
                                
                                <!-- Reverb Time -->
                                <div class="effect-control">
                                    <label for="reverb-time">Reverb Time</label>
                                    <input type="range" id="reverb-time" min="0.5" max="5" value="2" step="0.1">
                                    <span class="value-display">2.0s</span>
                                </div>
                                
                                <!-- Pan -->
                                <div class="effect-control">
                                    <label for="channel-pan">Pan (L/R)</label>
                                    <input type="range" id="channel-pan" min="-100" max="100" value="0" step="1">
                                    <span class="value-display">Centro</span>
                                </div>
                            </div>
                        </details>
                        
                    </div>
                    <div id="effects-panel-backdrop" class="effects-panel-backdrop" hidden></div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üéµ Terra MIDI</h3>
                    <p><strong>Plataforma NET-MIDI-T.A. oficial Terra Eletr√¥nica</strong></p>
                    <p>Exclusivo para clientes ‚Ä¢ Acesso gratuito ‚Ä¢ Suporte dedicado</p>
                </div>

                <div class="footer-section">
                    <h4>‚öñÔ∏è Informa√ß√µes Legais</h4>
                    <ul class="legal-links">
                        <li><a href="#" onclick="showPrivacyPolicy(); return false;">üìã Pol√≠tica de Privacidade (LGPD)</a></li>
                        <li><a href="#" onclick="showTermsOfService(); return false;">üìú Termos de Servi√ßo</a></li>
                        <li><a href="#" onclick="showCookiePolicy(); return false;">üç™ Pol√≠tica de Cookies</a></li>
                        <li><a href="#" onclick="showAccessibilityStatement(); return false;">‚ôø Declara√ß√£o de Acessibilidade</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>üìã Conformidade Legal</h4>
                    <ul class="legal-compliance">
                        <li>‚úÖ <strong>LGPD</strong> - Lei Geral de Prote√ß√£o de Dados</li>
                        <li>‚úÖ <strong>Marco Civil</strong> - Lei n¬∫ 12.965/2014</li>
                        <li>‚úÖ <strong>Lei de Acessibilidade</strong> - Lei n¬∫ 13.146/2015</li>
                        <li>‚úÖ <strong>GDPR Compatible</strong> - Compat√≠vel com RGPD</li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>üìû Contato &amp; Suporte</h4>
                    <p>üìß <a href="mailto:terra@terraeletronica.com.br">terra@terraeletronica.com.br</a></p>
                    <p>üí¨ WhatsApp: <strong>+55 12 99165-3176</strong></p>
                </div>
            </div>

            <!-- Legal Disclaimer -->
            <div class="footer-legal-disclaimer">
                <hr>
                <p class="disclaimer-text">
                    <strong>‚ö†Ô∏è Aviso Legal:</strong> 
                    TerraMidi √© uma ferramenta online de musicoterapia educacional. Este aplicativo n√£o fornece diagn√≥sticos m√©dicos, 
                    tratamento ou aconselhamento profissional. Consulte um profissional de sa√∫de qualificado para orienta√ß√µes m√©dicas.
                    <strong>‚ö° Privacidade: Todos os seus dados s√£o armazenados EXCLUSIVAMENTE na sua m√°quina (OPFS/IndexedDB/Filesystem API). 
                    Nenhum dado √© enviado para servidores remotos ou compartilhado com terceiros. Voc√™ tem controle total sobre seus dados.</strong>
                </p>
                <p class="copyright-text">
                    ¬© 2025 Terra Eletr√¥nica. Todos os direitos reservados. | 
                    <span id="footer-version">v1.0.0.0.0</span> | 
                    Desenvolvido para fins educacionais e terap√™uticos | 
                    üìß terra@terraeletronica.com.br
                </p>
            </div>
        </footer>
    </div>

    <!-- Audio Context (hidden) -->
    <div id="audio-context" class="is-hidden">
        <audio id="audio-player" preload="auto"></audio>
    </div>

    <!-- Scripts - ORDEM CR√çTICA para evitar undefined -->
    <script src="js/WebAudioFontPlayer.js"></script>
    <!-- audioEngine.js movido para cima, antes de app.js -->
    <script src="js/catalogManager.js"></script>
    <script src="js/catalogNavigationManager.js"></script>
    
    <!-- M√≥dulos utilit√°rios -->
    <script src="js/utils/dependencyLoader.js"></script>
    <script src="js/utils/initializationChecker.js"></script>
    <script src="js/utils/noteMappingUtils.js"></script>
    <script src="js/utils/instrumentCategories.js"></script>
    <script src="js/utils/sustainedNoteManager.js"></script>
    
    <!-- Sistema de cache local (IndexedDB) -->
    <script src="js/localCacheManager.js"></script>
    <script src="js/fileSystemCacheManager.js"></script>
    
    <!-- üß† Sistema de Cache Inteligente H√≠brido (PC + Mobile) -->
    <script src="js/hybridCacheManager.js"></script>
    
    <!-- üöÄ Advanced Installer - Instala√ß√£o Agressiva com Cache Multi-Layer -->
    <script src="js/advancedInstaller.js"></script>
    <script src="js/advancedInstallerUI.js"></script>

    <!-- ‚öñÔ∏è Modais Legais - LGPD, Marco Civil, Acessibilidade -->
    <script src="js/legalModals.js"></script>
    
    <!-- Novos m√≥dulos avan√ßados -->
    <script src="js/instrumentLoader.js"></script>
    <script src="js/effectsManager.js"></script>
    
  
    
    <!-- üéµ Instrumentos Sint√©ticos (Web Audio API) - SEM downloads externos -->
    <script src="js/synth/tibetanBowlSynth.js"></script>
    <script src="js/syntheticInstrumentManager.js"></script>
    
    <!-- ‚ö†Ô∏è ORDEM CR√çTICA: audioEngine DEVE carregar antes de app.js -->
    <script src="js/audioEngine.js"></script>
    
    <!-- üîí API Client Seguro (NUNCA exp√µe tokens) -->
    <script src="js/secureAPIClient.js"></script>
    
    <script src="src/mapping/programMap.js"></script>
    <script src="js/soundfontManager.js"></script>
  
    <!-- Sistema MIDI - Terra Eletr√¥nica -->
    <!-- M√≥dulo de compatibilidade entre navegadores (DEVE ser carregado PRIMEIRO) -->
    <script src="js/midi/browserCompatibility.js"></script>
    <script src="js/midi/midiTroubleshootingGuide.js"></script>
    <script src="js/midi/midiConnectionNotifier.js"></script>
    <script src="js/midi/midiDiagnostics.js"></script>
    <script src="js/midi/midiPerformanceEngine.js"></script>
    <script src="js/midi/midiDeviceManager.js"></script>
    <script src="js/midi/midiAutoReconnect.js"></script>
    <script src="js/midi/devices/boardBellsDevice.js"></script>
    <script src="js/midi/devices/terraDevicesTemplates.js"></script>
    <script src="js/midi/devices/boardBellaCatalog.js"></script>
    <script src="js/midi/devices/boardBellaDevice.js"></script>
    <script src="js/midi/devices/midiTerraDevice.js"></script>
    <script src="js/midi/midiOscilloscope.js"></script>
    <script src="js/midi/midiStatusPanel.js"></script>

    <script src="js/ui/catalogList.js"></script>
    <script src="js/ui/virtual-keyboard.js"></script>
    <script src="js/ui/instrumentSelector.js"></script>
    
    <!-- üåâ Service Worker Bridge - Gerenciamento de SW e recursos USB -->
    <script src="js/serviceWorkerBridge.js"></script>
    
    <!-- ÔøΩ PWA Installer - Gerenciamento de instala√ß√£o do PWA -->
    <script src="js/pwaInstaller.js"></script>
    
    <!-- ÔøΩüî• Handler global de erros de decodifica√ß√£o de √°udio -->
    <script>
        // Capturar erros de Promise n√£o tratados (incluindo decodeAudioData)
        window.addEventListener('unhandledrejection', function(event) {
            if (event.reason && event.reason.message && 
                event.reason.message.includes('decodeAudioData')) {
                
                console.error('üîä Erro global de decodifica√ß√£o de √°udio capturado:');
                console.error('   ‚îî‚îÄ', event.reason.message);
                
                // Prevenir que o erro apare√ßa no console como "Uncaught"
                event.preventDefault();
                
                // Opcional: notificar o usu√°rio
                if (window.showNotification) {
                    window.showNotification('Algumas amostras de √°udio n√£o puderam ser carregadas', 'warning');
                }
            }
        });
        
        // Log de inicializa√ß√£o
        console.log('üîä Handler de erros de √°udio inicializado');
    </script>
    
    <script src="js/patientManager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>